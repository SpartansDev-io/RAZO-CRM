generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserProfile {
  id                               String                  @id @db.Uuid
  fullName                         String                  @map("full_name")
  email                            String                  @unique
  phone                            String?
  role                             String                  @default("therapist")
  specialty                        String?
  licenseNumber                    String?                 @map("license_number")
  bio                              String?
  avatarUrl                        String?                 @map("avatar_url")
  passwordHash                     String                  @map("password_hash")
  notificationsEnabled             Boolean                 @default(true) @map("notifications_enabled")
  isActive                         Boolean                 @default(true) @map("is_active")
  createdAt                        DateTime                @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                        DateTime                @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  auditLogs                        AuditLog[]
  clinicalNotes                    ClinicalNote[]
  companiesCreated                 Company[]               @relation("CompanyCreatedBy")
  companiesUpdated                 Company[]               @relation("CompanyUpdatedBy")
  contractsCreated                 Contract[]              @relation("ContractCreatedBy")
  contractsUpdated                 Contract[]              @relation("ContractUpdatedBy")
  diagnoses                        Diagnosis[]
  documentTemplatesCreated         DocumentTemplate[]
  reportsGenerated                 MonthlyContractReport[] @relation("ReportGeneratedBy")
  reportsPaid                      MonthlyContractReport[] @relation("ReportPaidBy")
  reportsSent                      MonthlyContractReport[] @relation("ReportSentBy")
  monthlyReportSessionsAsTherapist MonthlyReportSession[]
  notifications                    Notification[]
  attachmentsUploaded              PatientAttachment[]
  patientsCreated                  Patient[]               @relation("PatientCreatedBy")
  patientsPrimary                  Patient[]               @relation("PatientPrimaryTherapist")
  patientsUpdated                  Patient[]               @relation("PatientUpdatedBy")
  paymentTransactionsProcessed     PaymentTransaction[]
  sessionsCancelled                Session[]               @relation("SessionCancelledBy")
  sessionsCreated                  Session[]               @relation("SessionCreatedBy")
  sessionsAsTherapist              Session[]               @relation("SessionTherapist")
  sessionsUpdated                  Session[]               @relation("SessionUpdatedBy")
  systemSettingsUpdated            SystemSetting[]
  tasksAssigned                    Task[]                  @relation("TaskAssignedTo")
  tasksCreated                     Task[]                  @relation("TaskCreatedBy")
  therapeuticGoals                 TherapeuticGoal[]
  therapistAvailability            TherapistAvailability[]

  @@map("user_profiles")
}

model Company {
  id                   String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String
  email                String                  @unique
  phone                String?
  address              String?
  website              String?
  industry             String?
  taxId                String?                 @map("tax_id")
  billingContactName   String?                 @map("billing_contact_name")
  billingContactEmail  String?                 @map("billing_contact_email")
  billingContactPhone  String?                 @map("billing_contact_phone")
  employeeCount        Int                     @default(0) @map("employee_count")
  activeContractsCount Int                     @default(0) @map("active_contracts_count")
  isActive             Boolean                 @default(true) @map("is_active")
  notes                String?
  createdBy            String?                 @map("created_by") @db.Uuid
  updatedBy            String?                 @map("updated_by") @db.Uuid
  createdAt            DateTime                @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime                @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt            DateTime?               @map("deleted_at") @db.Timestamptz(6)
  createdByUser        UserProfile?            @relation("CompanyCreatedBy", fields: [createdBy], references: [id])
  updatedByUser        UserProfile?            @relation("CompanyUpdatedBy", fields: [updatedBy], references: [id])
  companyEmployees     CompanyEmployee[]
  contracts            Contract[]
  monthlyReports       MonthlyContractReport[]
  patients             Patient[]

  @@index([name])
  @@index([email])
  @@index([isActive])
  @@index([createdBy])
  @@map("companies")
}

model Contract {
  id                          String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId                   String                  @map("company_id") @db.Uuid
  contractName                String                  @map("contract_name")
  contractNumber              String?                 @unique @map("contract_number")
  startDate                   DateTime                @map("start_date") @db.Date
  endDate                     DateTime                @map("end_date") @db.Date
  costPerSession              Decimal                 @map("cost_per_session") @db.Decimal(10, 2)
  monthlyLimit                Decimal?                @map("monthly_limit") @db.Decimal(10, 2)
  paymentFrequency            String                  @default("monthly") @map("payment_frequency")
  status                      String                  @default("active")
  autoRenew                   Boolean                 @default(false) @map("auto_renew")
  renewalNoticeDays           Int                     @default(30) @map("renewal_notice_days")
  notes                       String?
  attachmentUrl               String?                 @map("attachment_url")
  sendRenewalNotification     Boolean                 @default(true) @map("send_renewal_notification")
  lastRenewalNotificationSent DateTime?               @map("last_renewal_notification_sent") @db.Timestamptz(6)
  billingEmail                String?                 @map("billing_email")
  termsAcceptedAt             DateTime?               @map("terms_accepted_at") @db.Timestamptz(6)
  termsAcceptedBy             String?                 @map("terms_accepted_by")
  createdBy                   String?                 @map("created_by") @db.Uuid
  updatedBy                   String?                 @map("updated_by") @db.Uuid
  createdAt                   DateTime                @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                   DateTime                @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt                   DateTime?               @map("deleted_at") @db.Timestamptz(6)
  company                     Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdByUser               UserProfile?            @relation("ContractCreatedBy", fields: [createdBy], references: [id])
  updatedByUser               UserProfile?            @relation("ContractUpdatedBy", fields: [updatedBy], references: [id])
  monthlyReports              MonthlyContractReport[]
  paymentTransactions         PaymentTransaction[]
  sessions                    Session[]

  @@index([companyId])
  @@index([status])
  @@index([endDate])
  @@index([contractNumber])
  @@map("contracts")
}

model Patient {
  id                       String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                     String
  email                    String                    @unique
  phone                    String
  birthDate                DateTime                  @map("birth_date") @db.Date
  gender                   String
  companyId                String?                   @map("company_id") @db.Uuid
  companyName              String?                   @map("company_name")
  occupation               String?
  address                  String?
  city                     String?
  state                    String?
  zipCode                  String?                   @map("zip_code")
  maritalStatus            String?                   @map("marital_status")
  educationLevel           String?                   @map("education_level")
  nationality              String?
  religion                 String?
  livingSituation          String?                   @map("living_situation")
  hasChildren              Boolean                   @default(false) @map("has_children")
  childrenCount            Int                       @default(0) @map("children_count")
  primaryTherapistId       String?                   @map("primary_therapist_id") @db.Uuid
  therapyType              String                    @map("therapy_type")
  referredBy               String?                   @map("referred_by")
  referralSource           String?                   @map("referral_source")
  reasonForTherapy         String                    @map("reason_for_therapy")
  therapeuticGoalsText     String?                   @map("therapeutic_goals")
  expectations             String?
  previousTherapy          Boolean                   @default(false) @map("previous_therapy")
  previousTherapyDetails   String?                   @map("previous_therapy_details")
  currentMedications       String?                   @map("current_medications")
  allergies                String?
  medicalConditions        String?                   @map("medical_conditions")
  psychiatricDiagnoses     String?                   @map("psychiatric_diagnoses")
  familyPsychiatricHistory String?                   @map("family_psychiatric_history")
  substanceUse             String?                   @map("substance_use")
  riskAssessment           String?                   @map("risk_assessment")
  status                   String                    @default("active")
  dischargeDate            DateTime?                 @map("discharge_date") @db.Date
  dischargeReason          String?                   @map("discharge_reason")
  consentSigned            Boolean                   @default(false) @map("consent_signed")
  consentDate              DateTime?                 @map("consent_date") @db.Date
  privacyNoticeAccepted    Boolean                   @default(false) @map("privacy_notice_accepted")
  photoUrl                 String?                   @map("photo_url")
  preferredContactMethod   String?                   @map("preferred_contact_method")
  preferredLanguage        String                    @default("es") @map("preferred_language")
  insuranceProvider        String?                   @map("insurance_provider")
  insurancePolicyNumber    String?                   @map("insurance_policy_number")
  insuranceValidUntil      DateTime?                 @map("insurance_valid_until") @db.Date
  notes                    String?
  createdBy                String?                   @map("created_by") @db.Uuid
  updatedBy                String?                   @map("updated_by") @db.Uuid
  createdAt                DateTime                  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                DateTime                  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt                DateTime?                 @map("deleted_at") @db.Timestamptz(6)
  appointmentReminders     AppointmentReminder[]
  clinicalNotes            ClinicalNote[]
  companyEmployee          CompanyEmployee[]
  diagnoses                Diagnosis[]
  monthlyReportSessions    MonthlyReportSession[]
  attachments              PatientAttachment[]
  emergencyContacts        PatientEmergencyContact[]
  company                  Company?                  @relation(fields: [companyId], references: [id])
  createdByUser            UserProfile?              @relation("PatientCreatedBy", fields: [createdBy], references: [id])
  primaryTherapist         UserProfile?              @relation("PatientPrimaryTherapist", fields: [primaryTherapistId], references: [id])
  updatedByUser            UserProfile?              @relation("PatientUpdatedBy", fields: [updatedBy], references: [id])
  paymentTransactions      PaymentTransaction[]
  sessions                 Session[]
  support_network          support_network[]
  therapeuticGoals         TherapeuticGoal[]

  @@index([name])
  @@index([email])
  @@index([companyId])
  @@index([primaryTherapistId])
  @@index([status])
  @@index([birthDate])
  @@map("patients")
}

model PatientAttachment {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId      String       @map("patient_id") @db.Uuid
  fileName       String       @map("file_name")
  fileUrl        String       @map("file_url")
  fileType       String       @map("file_type")
  fileSizeKb     Int?         @map("file_size_kb")
  mimeType       String?      @map("mime_type")
  description    String?
  isConfidential Boolean      @default(true) @map("is_confidential")
  uploadedBy     String?      @map("uploaded_by") @db.Uuid
  createdAt      DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  patient        Patient      @relation(fields: [patientId], references: [id], onDelete: Cascade)
  uploadedByUser UserProfile? @relation(fields: [uploadedBy], references: [id])

  @@index([patientId])
  @@index([fileType])
  @@index([uploadedBy])
  @@map("patient_attachments")
}

model Session {
  id                     String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId              String                 @map("patient_id") @db.Uuid
  therapistId            String?                @map("therapist_id") @db.Uuid
  sessionNumber          Int?                   @map("session_number")
  sessionDate            DateTime               @map("session_date") @db.Timestamptz(6)
  sessionDurationMinutes Int                    @default(60) @map("session_duration_minutes")
  sessionType            String                 @map("session_type")
  sessionModality        String                 @default("in_person") @map("session_modality")
  appointmentType        String?                @map("appointment_type")
  meetLink               String?                @map("meet_link")
  locationAddress        String?                @map("location_address")
  sessionCost            Decimal                @map("session_cost") @db.Decimal(10, 2)
  billingType            String                 @default("direct") @map("billing_type")
  contractId             String?                @map("contract_id") @db.Uuid
  paymentStatus          String                 @default("pending") @map("payment_status")
  paidAmount             Decimal                @default(0) @map("paid_amount") @db.Decimal(10, 2)
  paymentDate            DateTime?              @map("payment_date") @db.Date
  paymentMethod          String?                @map("payment_method")
  paymentReference       String?                @map("payment_reference")
  sessionNotes           String?                @map("session_notes")
  progressNotes          String?                @map("progress_notes")
  interventions          String?
  homeworkAssigned       String?                @map("homework_assigned")
  nextSessionPlan        String?                @map("next_session_plan")
  riskLevel              String?                @map("risk_level")
  status                 String                 @default("scheduled")
  confirmedAt            DateTime?              @map("confirmed_at") @db.Timestamptz(6)
  confirmedBy            String?                @map("confirmed_by")
  remindersSent          Int                    @default(0) @map("reminders_sent")
  lastReminderSentAt     DateTime?              @map("last_reminder_sent_at") @db.Timestamptz(6)
  cancelledReason        String?                @map("cancelled_reason")
  cancelledBy            String?                @map("cancelled_by") @db.Uuid
  cancelledAt            DateTime?              @map("cancelled_at") @db.Timestamptz(6)
  createdBy              String?                @map("created_by") @db.Uuid
  updatedBy              String?                @map("updated_by") @db.Uuid
  createdAt              DateTime               @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt              DateTime               @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt              DateTime?              @map("deleted_at") @db.Timestamptz(6)
  appointmentReminders   AppointmentReminder[]
  clinicalNotes          ClinicalNote[]
  diagnoses              Diagnosis[]
  monthlyReportSessions  MonthlyReportSession[]
  paymentTransactions    PaymentTransaction[]
  sessionTechniques      SessionTechnique[]
  cancelledByUser        UserProfile?           @relation("SessionCancelledBy", fields: [cancelledBy], references: [id])
  contract               Contract?              @relation(fields: [contractId], references: [id])
  createdByUser          UserProfile?           @relation("SessionCreatedBy", fields: [createdBy], references: [id])
  patient                Patient                @relation(fields: [patientId], references: [id], onDelete: Cascade)
  therapist              UserProfile?           @relation("SessionTherapist", fields: [therapistId], references: [id])
  updatedByUser          UserProfile?           @relation("SessionUpdatedBy", fields: [updatedBy], references: [id])

  @@index([patientId])
  @@index([therapistId])
  @@index([contractId])
  @@index([sessionDate])
  @@index([status])
  @@index([paymentStatus])
  @@index([billingType])
  @@index([appointmentType])
  @@map("sessions")
}

model MonthlyContractReport {
  id                  String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contractId          String                 @map("contract_id") @db.Uuid
  companyId           String                 @map("company_id") @db.Uuid
  reportMonth         Int                    @map("report_month")
  reportYear          Int                    @map("report_year")
  periodStartDate     DateTime               @map("period_start_date") @db.Date
  periodEndDate       DateTime               @map("period_end_date") @db.Date
  totalSessions       Int                    @default(0) @map("total_sessions")
  totalPatients       Int                    @default(0) @map("total_patients")
  totalAmount         Decimal                @default(0) @map("total_amount") @db.Decimal(10, 2)
  paymentStatus       String                 @default("pending") @map("payment_status")
  invoiceNumber       String?                @map("invoice_number")
  invoiceDate         DateTime?              @map("invoice_date") @db.Date
  dueDate             DateTime?              @map("due_date") @db.Date
  paidAmount          Decimal                @default(0) @map("paid_amount") @db.Decimal(10, 2)
  paidAt              DateTime?              @map("paid_at") @db.Timestamptz(6)
  paidBy              String?                @map("paid_by") @db.Uuid
  paymentReference    String?                @map("payment_reference")
  paymentMethod       String?                @map("payment_method")
  sentToCompanyAt     DateTime?              @map("sent_to_company_at") @db.Timestamptz(6)
  sentBy              String?                @map("sent_by") @db.Uuid
  pdfUrl              String?                @map("pdf_url")
  notes               String?
  generatedBy         String?                @map("generated_by") @db.Uuid
  generatedAt         DateTime               @default(now()) @map("generated_at") @db.Timestamptz(6)
  createdAt           DateTime               @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime               @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  company             Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contract            Contract               @relation(fields: [contractId], references: [id], onDelete: Cascade)
  generatedByUser     UserProfile?           @relation("ReportGeneratedBy", fields: [generatedBy], references: [id])
  paidByUser          UserProfile?           @relation("ReportPaidBy", fields: [paidBy], references: [id])
  sentByUser          UserProfile?           @relation("ReportSentBy", fields: [sentBy], references: [id])
  reportSessions      MonthlyReportSession[]
  paymentTransactions PaymentTransaction[]

  @@unique([contractId, reportMonth, reportYear])
  @@index([contractId])
  @@index([companyId])
  @@index([reportYear, reportMonth])
  @@index([paymentStatus])
  @@index([dueDate])
  @@map("monthly_contract_reports")
}

model MonthlyReportSession {
  id            String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  reportId      String                @map("report_id") @db.Uuid
  sessionId     String                @map("session_id") @db.Uuid
  patientId     String                @map("patient_id") @db.Uuid
  patientName   String                @map("patient_name")
  therapistId   String?               @map("therapist_id") @db.Uuid
  therapistName String?               @map("therapist_name")
  sessionDate   DateTime              @map("session_date") @db.Timestamptz(6)
  sessionType   String                @map("session_type")
  sessionCost   Decimal               @map("session_cost") @db.Decimal(10, 2)
  createdAt     DateTime              @default(now()) @map("created_at") @db.Timestamptz(6)
  patient       Patient               @relation(fields: [patientId], references: [id], onDelete: Cascade)
  report        MonthlyContractReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  session       Session               @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  therapist     UserProfile?          @relation(fields: [therapistId], references: [id])

  @@unique([reportId, sessionId])
  @@index([reportId])
  @@index([sessionId])
  @@index([patientId])
  @@index([sessionDate])
  @@map("monthly_report_sessions")
}

model Notification {
  id                String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String      @map("user_id") @db.Uuid
  title             String
  message           String
  type              String
  priority          String      @default("normal")
  relatedEntityType String?     @map("related_entity_type")
  relatedEntityId   String?     @map("related_entity_id") @db.Uuid
  isRead            Boolean     @default(false) @map("is_read")
  isArchived        Boolean     @default(false) @map("is_archived")
  readAt            DateTime?   @map("read_at") @db.Timestamptz(6)
  actionUrl         String?     @map("action_url")
  actionLabel       String?     @map("action_label")
  metadata          Json?
  expiresAt         DateTime?   @map("expires_at") @db.Timestamptz(6)
  createdAt         DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  user              UserProfile @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isRead])
  @@index([type])
  @@index([priority])
  @@index([createdAt])
  @@map("notifications")
}

model Task {
  id                String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  assignedTo        String      @map("assigned_to") @db.Uuid
  createdBy         String      @map("created_by") @db.Uuid
  title             String
  description       String?
  priority          String      @default("medium")
  status            String      @default("pending")
  relatedEntityType String?     @map("related_entity_type")
  relatedEntityId   String?     @map("related_entity_id") @db.Uuid
  dueDate           DateTime?   @map("due_date") @db.Timestamptz(6)
  completedAt       DateTime?   @map("completed_at") @db.Timestamptz(6)
  tags              String[]
  createdAt         DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  assignedToUser    UserProfile @relation("TaskAssignedTo", fields: [assignedTo], references: [id], onDelete: Cascade)
  createdByUser     UserProfile @relation("TaskCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([assignedTo])
  @@index([status])
  @@index([dueDate])
  @@index([priority])
  @@index([relatedEntityType, relatedEntityId])
  @@map("tasks")
}

model ClinicalNote {
  id                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId          String             @map("session_id") @db.Uuid
  patientId          String             @map("patient_id") @db.Uuid
  therapistId        String             @map("therapist_id") @db.Uuid
  subjectiveNote     String?            @map("subjective_note")
  objectiveNote      String?            @map("objective_note")
  assessment         String?
  plan               String?
  moodAssessment     String?            @map("mood_assessment")
  anxietyLevel       Int?               @map("anxiety_level")
  depressionLevel    Int?               @map("depression_level")
  riskLevel          String?            @map("risk_level")
  riskNotes          String?            @map("risk_notes")
  progressRating     Int?               @map("progress_rating")
  treatmentAdherence String?            @map("treatment_adherence")
  interventionsUsed  String[]           @map("interventions_used")
  homeworkAssigned   String?            @map("homework_assigned")
  homeworkCompletion String?            @map("homework_completion")
  isConfidential     Boolean            @default(true) @map("is_confidential")
  isTemplate         Boolean            @default(false) @map("is_template")
  templateName       String?            @map("template_name")
  createdAt          DateTime           @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime           @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  patient            Patient            @relation(fields: [patientId], references: [id], onDelete: Cascade)
  session            Session            @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  therapist          UserProfile        @relation(fields: [therapistId], references: [id], onDelete: SetNull)
  sessionTechniques  SessionTechnique[]

  @@index([sessionId])
  @@index([patientId])
  @@index([therapistId])
  @@index([riskLevel])
  @@map("clinical_notes")
}

model TherapeuticGoal {
  id                 String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId          String       @map("patient_id") @db.Uuid
  therapistId        String?      @map("therapist_id") @db.Uuid
  goalTitle          String       @map("goal_title")
  goalDescription    String?      @map("goal_description")
  goalCategory       String?      @map("goal_category")
  targetDate         DateTime?    @map("target_date") @db.Date
  status             String       @default("active")
  progressPercentage Int          @default(0) @map("progress_percentage")
  specificCriteria   String?      @map("specific_criteria")
  measurableCriteria String?      @map("measurable_criteria")
  achievableNotes    String?      @map("achievable_notes")
  relevantNotes      String?      @map("relevant_notes")
  timeBoundDate      DateTime?    @map("time_bound_date") @db.Date
  lastReviewedAt     DateTime?    @map("last_reviewed_at") @db.Timestamptz(6)
  achievedAt         DateTime?    @map("achieved_at") @db.Timestamptz(6)
  abandonedReason    String?      @map("abandoned_reason")
  notes              String?
  createdAt          DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  patient            Patient      @relation(fields: [patientId], references: [id], onDelete: Cascade)
  therapist          UserProfile? @relation(fields: [therapistId], references: [id])

  @@index([patientId])
  @@index([status])
  @@index([therapistId])
  @@map("therapeutic_goals")
}

model TherapistAvailability {
  id             String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  therapistId    String      @map("therapist_id") @db.Uuid
  dayOfWeek      Int         @map("day_of_week")
  startTime      DateTime    @map("start_time") @db.Time(6)
  endTime        DateTime    @map("end_time") @db.Time(6)
  isAvailable    Boolean     @default(true) @map("is_available")
  location       String?
  effectiveFrom  DateTime    @map("effective_from") @db.Date
  effectiveUntil DateTime?   @map("effective_until") @db.Date
  notes          String?
  createdAt      DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime    @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  therapist      UserProfile @relation(fields: [therapistId], references: [id], onDelete: Cascade)

  @@index([therapistId])
  @@index([dayOfWeek])
  @@index([effectiveFrom, effectiveUntil])
  @@map("therapist_availability")
}

model AppointmentReminder {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId       String    @map("session_id") @db.Uuid
  patientId       String    @map("patient_id") @db.Uuid
  reminderType    String    @map("reminder_type")
  scheduledFor    DateTime  @map("scheduled_for") @db.Timestamptz(6)
  status          String    @default("pending")
  sentAt          DateTime? @map("sent_at") @db.Timestamptz(6)
  messageTemplate String?   @map("message_template")
  messageSent     String?   @map("message_sent")
  errorMessage    String?   @map("error_message")
  retryCount      Int       @default(0) @map("retry_count")
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  patient         Patient   @relation(fields: [patientId], references: [id], onDelete: Cascade)
  session         Session   @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([patientId])
  @@index([scheduledFor])
  @@index([status])
  @@map("appointment_reminders")
}

model PaymentTransaction {
  id                String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId         String?                @map("session_id") @db.Uuid
  patientId         String?                @map("patient_id") @db.Uuid
  contractId        String?                @map("contract_id") @db.Uuid
  reportId          String?                @map("report_id") @db.Uuid
  transactionType   String                 @map("transaction_type")
  amount            Decimal                @db.Decimal(10, 2)
  paymentMethod     String?                @map("payment_method")
  paymentReference  String?                @map("payment_reference")
  currency          String                 @default("MXN")
  exchangeRate      Decimal                @default(1.0) @map("exchange_rate") @db.Decimal(10, 4)
  status            String                 @default("completed")
  bankName          String?                @map("bank_name")
  accountLastFour   String?                @map("account_last_four")
  authorizationCode String?                @map("authorization_code")
  notes             String?
  processedBy       String?                @map("processed_by") @db.Uuid
  transactionDate   DateTime               @default(now()) @map("transaction_date") @db.Timestamptz(6)
  createdAt         DateTime               @default(now()) @map("created_at") @db.Timestamptz(6)
  contract          Contract?              @relation(fields: [contractId], references: [id])
  patient           Patient?               @relation(fields: [patientId], references: [id])
  processedByUser   UserProfile?           @relation(fields: [processedBy], references: [id])
  report            MonthlyContractReport? @relation(fields: [reportId], references: [id])
  session           Session?               @relation(fields: [sessionId], references: [id])

  @@index([sessionId])
  @@index([patientId])
  @@index([contractId])
  @@index([transactionDate])
  @@index([status])
  @@map("payment_transactions")
}

model Diagnosis {
  id                String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId         String       @map("patient_id") @db.Uuid
  therapistId       String?      @map("therapist_id") @db.Uuid
  sessionId         String?      @map("session_id") @db.Uuid
  diagnosisCode     String?      @map("diagnosis_code")
  diagnosisName     String       @map("diagnosis_name")
  diagnosisCategory String?      @map("diagnosis_category")
  diagnosisType     String?      @map("diagnosis_type")
  severity          String?
  diagnosedAt       DateTime     @map("diagnosed_at") @db.Date
  resolvedAt        DateTime?    @map("resolved_at") @db.Date
  clinicalNotes     String?      @map("clinical_notes")
  treatmentPlan     String?      @map("treatment_plan")
  isActive          Boolean      @default(true) @map("is_active")
  createdAt         DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  patient           Patient      @relation(fields: [patientId], references: [id], onDelete: Cascade)
  session           Session?     @relation(fields: [sessionId], references: [id])
  therapist         UserProfile? @relation(fields: [therapistId], references: [id])

  @@index([patientId])
  @@index([therapistId])
  @@index([isActive])
  @@index([diagnosisCode])
  @@map("diagnoses")
}

model DocumentTemplate {
  id            String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdBy     String?      @map("created_by") @db.Uuid
  templateName  String       @map("template_name")
  templateType  String       @map("template_type")
  content       String
  variables     Json?
  isActive      Boolean      @default(true) @map("is_active")
  isPublic      Boolean      @default(false) @map("is_public")
  usageCount    Int          @default(0) @map("usage_count")
  createdAt     DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  createdByUser UserProfile? @relation(fields: [createdBy], references: [id])

  @@index([templateType])
  @@index([isPublic])
  @@index([createdBy])
  @@map("document_templates")
}

model SystemSetting {
  id            String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  settingKey    String       @unique @map("setting_key")
  settingValue  Json         @map("setting_value")
  settingType   String       @map("setting_type")
  description   String?
  category      String?
  isPublic      Boolean      @default(false) @map("is_public")
  updatedBy     String?      @map("updated_by") @db.Uuid
  createdAt     DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  updatedByUser UserProfile? @relation(fields: [updatedBy], references: [id])

  @@index([settingKey])
  @@index([category])
  @@map("system_settings")
}

model AuditLog {
  id         String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId     String?      @map("user_id") @db.Uuid
  action     String
  entityType String       @map("entity_type")
  entityId   String?      @map("entity_id") @db.Uuid
  changes    Json?
  ipAddress  String?      @map("ip_address")
  userAgent  String?      @map("user_agent")
  severity   String       @default("info")
  createdAt  DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  user       UserProfile? @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@index([action])
  @@map("audit_log")
}

model SessionTechnique {
  id                  String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId           String        @map("session_id") @db.Uuid
  clinicalNoteId      String?       @map("clinical_note_id") @db.Uuid
  techniqueName       String        @map("technique_name")
  techniqueCategory   String?       @map("technique_category")
  effectivenessRating Int?          @map("effectiveness_rating")
  patientResponse     String?       @map("patient_response")
  notes               String?
  createdAt           DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  clinicalNote        ClinicalNote? @relation(fields: [clinicalNoteId], references: [id], onDelete: Cascade)
  session             Session       @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([techniqueCategory])
  @@index([techniqueName])
  @@map("session_techniques")
}

model PatientEmergencyContact {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId      String   @map("patient_id") @db.Uuid
  contactName    String   @map("contact_name")
  relationship   String
  phone          String
  alternatePhone String?  @map("alternate_phone")
  email          String?
  isPrimary      Boolean  @default(false) @map("is_primary")
  priority       Int      @default(1)
  notes          String?
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  patient        Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@index([patientId])
  @@index([patientId, isPrimary])
  @@map("patient_emergency_contacts")
}

model CompanyEmployee {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId        String    @map("company_id") @db.Uuid
  patientId        String?   @map("patient_id") @db.Uuid
  employeeName     String    @map("employee_name")
  employeeEmail    String?   @map("employee_email")
  employeeIdNumber String?   @map("employee_id_number")
  department       String?
  position         String?
  isActive         Boolean   @default(true) @map("is_active")
  startDate        DateTime? @map("start_date") @db.Date
  endDate          DateTime? @map("end_date") @db.Date
  notes            String?
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  company          Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  patient          Patient?  @relation(fields: [patientId], references: [id])

  @@index([companyId])
  @@index([patientId])
  @@index([isActive])
  @@map("company_employees")
}

model support_network {
  support_id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patient_id           String   @db.Uuid
  full_name            String   @db.VarChar(150)
  relationship         String   @db.VarChar(100)
  phone                String?  @db.VarChar(20)
  email                String?  @db.VarChar(150)
  emergency_contact    Boolean  @default(false)
  legal_representative Boolean  @default(false)
  created_at           DateTime @default(now()) @db.Timestamp(6)
  updated_at           DateTime @default(now()) @db.Timestamp(6)
  patients             Patient  @relation(fields: [patient_id], references: [id], onDelete: Cascade, map: "fk_support_patient")
}
